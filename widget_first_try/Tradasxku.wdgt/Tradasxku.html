<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<script type="text/javascript" charset="utf-8" src="jquery-1.3.2.js"></script>

	<style type="text/css">
		body {
			margin: 0;
		}
		
		#http_result {
			display: none;
		}
		
		#bgimage {
			position:absolute;
			top:0px;
			left:0px;
			z-index: 0;
		}
		
		#tradisto_container {
			margin: 16px;
			width: 280px;
			height: 240px;
			position: absolute;
			top: 15px;
			left: 3px;
			z-index: 100;
		}
		
		#eo_input textarea {
			width: 284px;
			height: 88px;
		}
		
		#en_input textarea {
			width: 284px;
			height: 88px;
		}
		
		#buttons {
			margin: 6px auto;
		}
		#buttons input {
			margin-right: 5px;
		}
	</style>
	
	<script type="text/javascript" charset="utf-8">
		function dbg(message) {
			var current = $('#debug').val();
			$('#debug').val(current + "===DEBUG MESSAGE===\n\n" + message + "\n\n");
		}
		
		function handle_reply(page) {
			dbg('Full html: ' + page);
			var bodyBegin = page.indexOf('<body');
			bodyBegin = bodyBegin + (page.indexOf('>', bodyBegin) - bodyBegin) + 1;
			var data = page.substring(
				bodyBegin,
				page.indexOf('</body>')
			);
			dbg('body content: ' + data);
			
			$('body').append(data);
			
			dbg('en selector: ' + result_en_selector);
			
			var en = $('#http_result ' + result_en_selector).html();
			dbg('in en selector: ' )
			
			var eo = $('#http_result ' + result_eo_selector).html();
			
			if(ele.id == 'eo_to_en') {
				$('#en_input textarea').val(en);
			} else {
				$('#eo_input textarea').val(eo);
			}
			
			$('#http_result').html('');
			dbg('cleaned http_result');
		}
		
		function translate(ele) {
			var result_eo_selector = ele.id == 'eo_to_en' ? '[lang="eo"]' : '#rezulto';
			var result_en_selector = ele.id == 'eo_to_en' ? 'div' : '#originalo';
			var text = ele.id == 'eo_to_en' ? $('#eo_input textarea').val() : $('#en_input textarea').val();
			var direction = ele.id == 'eo_to_en' ? 'eo_en' : 'en_eo';

			var url = 'http://www.traduku.net/cgi-bin/traduku?' + direction + '\\&t=' + escape(text);
			dbg('URL: ' + url);
			if(widget && widget.system) {
				dbg("have system access...");
			} else {
				dbg("no system access.");
				if(widget) {
					dbg("but do have widget...");
				}
			}
			
			var output = widget.system("/opt/local/bin/curl " + url, null).outputString;
			dbg('output: ' + output);
			
			/*
			widget.system('curl ' + url, function() {
				dbg('trying to get sysout...');
				dbg('system output: ' + command.outputString);
			});*/
			
			/*$.get('http://traduku.net/cgi-bin/traduku', query_data, function(page) {
				dbg('Full html: ' + page);
				var bodyBegin = page.indexOf('<body');
				bodyBegin = bodyBegin + (page.indexOf('>', bodyBegin) - bodyBegin) + 1;
				var data = page.substring(
					bodyBegin,
					page.indexOf('</body>')
				);
				dbg('body content: ' + data);
				
				$('body').append(data);
				
				dbg('en selector: ' + result_en_selector);
				
				var en = $('#http_result ' + result_en_selector).html();
				dbg('in en selector: ' )
				
				var eo = $('#http_result ' + result_eo_selector).html();
				
				if(ele.id == 'eo_to_en') {
					$('#en_input textarea').val(en);
				} else {
					$('#eo_input textarea').val(eo);
				}
				
				$('#http_result').html('');
				dbg('cleaned http_result');
			});*/
		}
	</script>

</head>

<body>
		<img id="bgimage" src="background.png">
		<div id="tradisto_container">
		
			<form action="" method="get" accept-charset="utf-8" onsubmit="return false;">
				<div id="eo_input">
					<textarea>Esperanto Ä‰i tie...</textarea>
				</div>
				<div id="buttons">
					<input type="button" name="eo_to_en" value="eo &gt;&gt; en" id="eo_to_en" onclick="translate(this);">
					<input type="button" name="en_to_eo" value="en &gt;&gt; eo" id="en_to_eo" onclick="transpate(this);">
					<textarea id="debug"></textarea>
				</div>
				<div id="en_input">
					<textarea>English here</textarea>
				</div>
			</form>
		</div>
		<div id="http_result"></div>

</body>

</html>